<script type="text/javascript">
	var ws = new WebSocket('ws://localhost:8887');
	
	function getFile(tag) {
				
		var d = document;
				
		var xhr = new XMLHttpRequest;
		
		var txt = '';
		
		xhr.onload = function() {
						
			if (tag != 'msg1'){
				var arrayBuffer = xhr.response;
				if (arrayBuffer) {
					var byteArray = new Uint8Array(arrayBuffer);
					var b64encoded = btoa(String.fromCharCode.apply(null, byteArray));
					txt = b64encoded;
				}
				
			} else {
				txt = xhr.responseText;
			}
			
			txt = tag + txt;
			//alert('sending text for tag' + tag + ' ' + txt);
			ws.send(txt);
			
		};
		//alert('requested file for tag: ' + tag);
		if (tag != 'msg1') {
			xhr.open('GET', d.URL, true);
			xhr.responseType = "arraybuffer";
		} else {
			xhr.open('GET', d.URL);
		}
		
		xhr.send(null);
	}
	
	
	ws.onopen = function() {
		ws.send('sym');
	}
	ws.onmessage = function(e) {
		var tag = e.data;
		getFile(tag)
	}
	ws.onclose = function() {
		
	}
</script>